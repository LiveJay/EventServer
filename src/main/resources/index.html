<html lang="en">
<head>
    <meta charset="utf-8">

    <title>EventServer</title>


    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
    <![endif]-->
    <script src="https://cdn.jsdelivr.net/sockjs/1/sockjs.min.js"></script>
    <script src="https://rawgit.com/vert-x3/vertx-bus-bower/master/vertx-eventbus.js"></script>
</head>

<body>
<div>
    <button onclick="openConnection()">Open Connection</button>
    <button onclick="sendUpdate()">Update</button>
</div>
<div>
    <label for="authToken">Auth-Token:</label>
</div>
<div>
    <input type="text" id="authToken" value="testToken"/>
</div>
<div>
    <label for="messages">Messages:</label>
</div>
<div>
    <textarea id="messages" rows="30" cols="100" readonly="readonly"></textarea>
</div>

<script>
    var socket;
    window.openConnection = function () {
        var token = document.getElementById("authToken").value;
        var url = "socket?token="+token;
        var options = {};
        var socket = new SockJS(url, null, options);
        var printMessage = function (text) {
            console.log(text);
            var textArea = document.getElementById("messages");
            textArea.value = text + "\n" + textArea.value;
        };
        socket.onopen = function(event) {
            printMessage("connected: "+JSON.stringify(event));
        };
        socket.onclose = function (event) {
            printMessage("close: "+JSON.stringify(event));
        };
        socket.onerror = function (event) {
            printMessage("error: "+JSON.stringify(event));
        };
        socket.onmessage = function (event) {
            printMessage("message: "+JSON.stringify(event.data));
        };
    };

    window.sendUpdate = function () {
        socket.send("update")
    }
</script>
</body>
</html>